import{d as G,i as S,j as T,x as $,y as z,k as E,c as f,m as c,a,w as l,u as g,z as _,A as v,B as k,C as F,D as b,g as i,o as m,F as P,b as q,f as D,E as C,t as p,e as H,G as J,H as M,_ as O}from"./index-6ebd5fd7.js";import{C as U}from"./CommonHeader-a8bbfa0e.js";const j={class:"cart"},K={class:"cart-body"},Q=["onClick"],R=["src"],W={class:"good-desc"},X={class:"title-and-count"},Y={class:"title"},Z={class:"count"},ee={class:"price-and-step"},te={class:"price"},se=G({__name:"index",setup(oe){const u=S(),e=T({checkAll:!0,goodList:[],idList:[]}),x=async()=>{if(e.idList.length===0){_("请先选择商品再进行结算！");return}const s=JSON.parse(JSON.stringify(e.idList));v.push({path:"/create-order",query:{ids:s}})};$(()=>e.idList.length,s=>{s!==e.goodList.length?e.checkAll=!1:e.checkAll=!0});const I=z(()=>e.goodList.reduce((s,t)=>e.idList.includes(t.cartItemId)?s+t.goodsCount*t.sellingPrice:s,0)),y=async(s,t)=>{const n=Number(s),r=Number(t.name);if(n>5){_("超出单个商品的最大购买数量");return}if(n<1){_("商品不得小于0");return}k({message:"修改中...",forbidClick:!0}),await J(n,r),e.goodList.forEach(d=>{d.cartItemId===r&&(d.goodsCount=n)}),b()},L=async s=>{await M(s),h()},h=async()=>{k({message:"修改中...",forbidClick:!0});const{data:{data:s}}=await F();e.goodList=s,e.idList=s.map(t=>t.cartItemId),b()},w=()=>{e.checkAll?u.value.toggleAll(!0):u.value.toggleAll()};return E(async()=>{h()}),(s,t)=>{const n=i("van-checkbox"),r=i("van-stepper"),d=i("van-button"),A=i("van-swipe-cell"),V=i("van-checkbox-group"),N=i("van-submit-bar");return m(),f("div",j,[c(U,{title:"购物车","left-arrow":!0,"icon-size":18}),a("div",K,[c(V,{modelValue:e.idList,"onUpdate:modelValue":t[2]||(t[2]=o=>e.idList=o),ref_key:"checkboxGroup",ref:u},{default:l(()=>[(m(!0),f(P,null,q(e.goodList,o=>(m(),D(A,{"right-width":50,key:o.cartItemId},{right:l(()=>[c(d,{square:"",text:"删除",type:"danger",class:"delete-button",onClick:B=>L(o.cartItemId)},null,8,["onClick"])]),default:l(()=>[a("div",{class:"good",onClick:B=>g(v).push(`/info/${o.goodsId}`)},[c(n,{"icon-size":"0.533334rem",name:o.cartItemId,"checked-color":"#1baeae",onClick:t[0]||(t[0]=C(()=>{},["stop"]))},null,8,["name"]),a("img",{class:"good-img",src:s.$filters.prefix(o.goodsCoverImg)},null,8,R),a("div",W,[a("div",X,[a("span",Y,p(o.goodsName),1),a("span",Z,"x"+p(o.goodsCount),1)]),a("div",ee,[a("div",te,"¥"+p(o.sellingPrice),1),c(r,{"model-value":o.goodsCount,integer:"",min:"1",max:"5","auto-fixed":!0,name:o.cartItemId,onChange:y,onClick:t[1]||(t[1]=C(()=>{},["stop"]))},null,8,["model-value","name"])])])],8,Q)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),c(N,{class:"submit-all",price:g(I)*100,"button-text":"结算",onSubmit:x},{default:l(()=>[c(n,{"checked-color":"#1baeae",modelValue:e.checkAll,"onUpdate:modelValue":t[3]||(t[3]=o=>e.checkAll=o),onClick:w},{default:l(()=>[H("全选")]),_:1},8,["modelValue"])]),_:1},8,["price"])])}}});const ce=O(se,[["__scopeId","data-v-07081243"]]);export{ce as default};
