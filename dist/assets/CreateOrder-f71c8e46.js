import{C as $}from"./CommonHeader-a8bbfa0e.js";import{a as L,c as T}from"./address-c72b5d82.js";import{d as A,K as B,j as D,y as j,k as q,c as m,a as e,m as i,t as n,e as u,F as f,b as F,u as y,w as _,B as V,W as E,D as C,g as h,o as g,p as J,q as R,N as G,s as H,P as K,_ as M}from"./index-6ebd5fd7.js";import{s as U,p as W}from"./order-83b1c9ec.js";const z=a=>{localStorage.setItem("cateItemId",JSON.stringify(a))},Q=()=>{const a=localStorage.getItem("cateItemId");return a&&JSON.parse(a)},w=()=>{localStorage.removeItem("cateItemId")},X=a=>(J("data-v-b3d8c845"),a=a(),R(),a),Y={class:"create-order"},Z={class:"name-and-phone"},ss={class:"address-detail"},es={class:"good-list"},ts=["onClick"],os=["src"],as={class:"good-desc"},ds={class:"title-and-count"},rs={class:"title"},ns={class:"count"},cs={class:"price"},is={class:"create-order"},ls={class:"price"},ps=X(()=>e("span",null,"商品金额",-1)),us={style:{width:"90%",margin:"0 auto",padding:"50px 0"}},_s=A({__name:"CreateOrder",setup(a){const N=G(),c=H(),k=B(),s=D({goodList:[],address:{addressId:0,cityName:"",createTime:"",defaultFlag:0,detailAddress:"",isDeleted:0,provinceName:"",regionName:"",updateTime:"",userId:0,userName:"",userPhone:""},showPay:!1,ids:[],orderNo:""}),b=j(()=>s.goodList.reduce((o,t)=>o+t.goodsCount*t.sellingPrice,0)),S=()=>{c.push({path:"/address",query:{ids:s.ids,from:"create-order"}})},O=async()=>{V({message:"加载中",forbidClick:!0});try{const{addressId:o,ids:t}=N.query,r=t||Q();z(r);const{data:{data:l}}=await E(r.join(",")),{data:{data:p}}=o?await L(o):await T();p||c.push("/address"),s.goodList=l,s.address=p,s.ids=r}catch(o){console.log("Error:",o),C(),c.replace("/home")}C()},P=()=>{w()},x=async()=>{const o={addressId:s.address.addressId,cartItemIds:s.goodList.map(r=>r.cartItemId)},{data:{data:t}}=await U(o);w(),s.orderNo=t,s.showPay=!0,k.updateCart()},v=()=>{c.push("/order")},I=async o=>{await W(s.orderNo,o),K("支付成功！"),setTimeout(()=>{c.push("/order")},2e3)};return q(()=>{O()}),(o,t)=>{const r=h("van-icon"),l=h("van-button"),p=h("van-popup");return g(),m(f,null,[e("div",Y,[i($,{title:"生成订单",onCallback:P,path:"/cart"}),e("div",{class:"address",onClick:S},[e("div",Z,[e("span",null,n(s.address.userName),1),u("  "),e("span",null,n(s.address.userPhone),1)]),e("div",ss,n(`${s.address.provinceName} ${s.address.cityName} ${s.address.regionName}
                                ${s.address.detailAddress}`),1),i(r,{name:"arrow",class:"arrow"})]),e("div",es,[(g(!0),m(f,null,F(s.goodList,d=>(g(),m("div",{class:"good",key:d.cartItemId,onClick:ms=>y(c).push(`/info/${d.goodsId}`)},[e("img",{src:o.$filters.prefix(d.goodsCoverImg),alt:""},null,8,os),e("div",as,[e("div",ds,[e("span",rs,n(d.goodsName),1),e("span",ns,"x"+n(d.goodsCount),1)]),e("div",cs,"¥"+n(d.sellingPrice),1)])],8,ts))),128))]),e("div",is,[e("div",ls,[ps,e("span",null,"￥"+n(y(b)),1)]),i(l,{type:"primary",onClick:x},{default:_(()=>[u("生成订单")]),_:1})])]),i(p,{closeable:"",show:s.showPay,"onUpdate:show":t[2]||(t[2]=d=>s.showPay=d),position:"bottom",style:{height:"30%"},onClickOverlay:v,onClickCloseIcon:v},{default:_(()=>[e("div",us,[i(l,{style:{marginBottom:"10px"},color:"#1989fa",block:"",onClick:t[0]||(t[0]=d=>I(1))},{default:_(()=>[u("支付宝支付")]),_:1}),i(l,{color:"#4fc08d",block:"",onClick:t[1]||(t[1]=d=>I(2))},{default:_(()=>[u("微信支付")]),_:1})])]),_:1},8,["show"])],64)}}});const fs=M(_s,[["__scopeId","data-v-b3d8c845"]]);export{fs as default};
