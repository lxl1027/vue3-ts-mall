import{C as z}from"./CommonHeader-a8bbfa0e.js";import{_ as V,x as W,k,o as x,c as T,a as d,d as P,K as B,j as q,i as E,m as f,u as i,w,z as b,L as S,g as M,t as N,e as $,p as L,q as R,s as U}from"./index-6ebd5fd7.js";import{l as j,r as D}from"./user-b31528a5.js";const F={class:"s-canvas"},K=["width","height"],O={__name:"SIdentify",props:{identifyCode:{type:String,default:"1234"},fontSizeMin:{type:Number,default:35},fontSizeMax:{type:Number,default:35},backgroundColorMin:{type:Number,default:180},backgroundColorMax:{type:Number,default:240},colorMin:{type:Number,default:50},colorMax:{type:Number,default:160},lineColorMin:{type:Number,default:100},lineColorMax:{type:Number,default:200},dotColorMin:{type:Number,default:0},dotColorMax:{type:Number,default:255},contentWidth:{type:Number,default:120},contentHeight:{type:Number,default:40}},setup(m){const o=m,s=(e,a)=>Math.floor(Math.random()*(a-e)+e),t=(e,a)=>{let r=s(e,a),g=s(e,a),u=s(e,a);return"rgb("+r+","+g+","+u+")"},C=e=>{for(let a=0;a<3;a++)e.strokeStyle=t(o.lineColorMin,o.lineColorMax),e.beginPath(),e.moveTo(s(0,o.contentWidth),s(0,o.contentHeight)),e.lineTo(s(0,o.contentWidth),s(0,o.contentHeight)),e.stroke()},p=(e,a,r)=>{e.fillStyle=t(o.colorMin,o.colorMax),e.font=s(o.fontSizeMin,o.fontSizeMax)+"px SimHei";let g=(r+1)*(o.contentWidth/(o.identifyCode.length+1)),u=s(o.fontSizeMax,o.contentHeight-5);var _=s(-10,10);e.translate(g,u),e.rotate(_*Math.PI/100),e.fillText(a,0,0),e.rotate(-_*Math.PI/100),e.translate(-g,-u)},v=e=>{for(let a=0;a<30;a++)e.fillStyle=t(0,255),e.beginPath(),e.arc(s(0,o.contentWidth),s(0,o.contentHeight),1,0,2*Math.PI),e.fill()},h=()=>{let a=document.getElementById("s-canvas").getContext("2d");a.textBaseline="bottom",a.fillStyle=t(o.backgroundColorMin,o.backgroundColorMax),a.fillRect(0,0,o.contentWidth,o.contentHeight);for(let r=0;r<o.identifyCode.length;r++)p(a,o.identifyCode[r],r);C(a),v(a)};return W(()=>o.identifyCode,(e,a)=>{h()}),k(()=>{h()}),(e,a)=>(x(),T("div",F,[d("canvas",{id:"s-canvas",width:o.contentWidth,height:o.contentHeight},null,8,K)]))}},A=V(O,[["__scopeId","data-v-c45b1c82"]]),G=m=>(L("data-v-0aa36748"),m=m(),R(),m),J={class:"login"},Q=G(()=>d("img",{class:"logo",src:"https://s.yezgea02.com/1604045825972/newbee-mall-vue3-app-logo.png",width:"100",height:"100",alt:""},null,-1)),X={class:"login-form"},Y={class:"identify-code"},Z={class:"change-log-reg"},ee={style:{margin:"16px"}},te=P({__name:"index",setup(m){const o=B(),s=U();let t=q({username:"",password:"",isTitle:!0,identifyCode:""});const C=()=>{t.isTitle=!t.isTitle,p()},p=()=>{t.username="",t.password="",t.identifyCode="",_()},v=async()=>{if(!h(t.username))return b("用户名格式错误");if(!e(t.password))return b("密码格式错误");if(t.identifyCode!==r.value)return t.identifyCode="",_(),b("验证码有误");if(t.isTitle)try{await j(t.username,t.password),S({message:"登录成功",type:"success",duration:1e3,background:"#1baeae",color:"#fff"}),o.updateCart(),s.replace("/home")}catch(n){p(),console.log("Error:",n)}else try{await D(t.username,t.password),S({message:"注册成功",type:"success",duration:1e3,background:"#1baeae",color:"#fff"}),p(),t.isTitle=!0}catch(n){p(),console.log("Error:",n)}},h=n=>!!/^1[3-9]\d{9}$/.test(n),e=n=>n.length>=6&&n.length<=16;let a="1234567890",r=E("");const g=(n,l)=>Math.floor(Math.random()*(l-n)+n),u=(n,l)=>{for(let c=0;c<l;c++)r.value+=n[g(0,n.length)]},_=()=>{r.value="",u(a,4)};return k(()=>{r.value="",u(a,4)}),(n,l)=>{const c=M("van-field"),I=M("van-button"),H=M("van-form");return x(),T("div",J,[f(z,{title:i(t).isTitle?"登录":"注册"},null,8,["title"]),Q,d("section",X,[f(H,{onSubmit:v},{default:w(()=>[f(c,{modelValue:i(t).username,"onUpdate:modelValue":l[0]||(l[0]=y=>i(t).username=y),name:"用户名",label:"用户名",placeholder:"请输入手机号",rules:[{required:!0,message:"请填写用户名"},{validator:h,message:"请输入正确格式的手机号码"}]},null,8,["modelValue","rules"]),f(c,{modelValue:i(t).password,"onUpdate:modelValue":l[1]||(l[1]=y=>i(t).password=y),type:"password",name:"密码",label:"密码",placeholder:"密码",rules:[{required:!0,message:"请填写密码"},{validator:e,message:"密码的长度要在6到16个字符之间"}]},null,8,["modelValue","rules"]),f(c,{modelValue:i(t).identifyCode,"onUpdate:modelValue":l[2]||(l[2]=y=>i(t).identifyCode=y),name:"验证码",label:"验证码",placeholder:"请输入验证码",rules:[{required:!0,message:"请填写验证码"}]},null,8,["modelValue"]),d("div",Y,[f(A,{identifyCode:i(r)},null,8,["identifyCode"]),d("a",{onClick:_,class:"change-code",href:"javascript:;"},"换一张")]),d("div",{onClick:C},[d("p",Z,N(i(t).isTitle?"立即注册":"已有账号，立即登录"),1)]),d("div",ee,[f(I,{round:"",block:"",type:"primary","native-type":"submit"},{default:w(()=>[$(N(i(t).isTitle?"登录":"注册"),1)]),_:1})])]),_:1})])])}}});const se=V(te,[["__scopeId","data-v-0aa36748"]]);export{se as default};
